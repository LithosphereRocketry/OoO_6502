# OoO_6502

## Notes

This project operates on a slightly simplified model of the 6502's interfaces:
as with Arlet Ottens' verilog-6502 core, memory interfaces are considered to be
synchronous.

## Setup

This repository is set up to be built on Linux and similar Unix systems. On
Windows, it can be run through WSL.

* Install the required tools:
  * `git`
  * `python3`
  * `make`
  * `iverilog`
  * `gtkwave`
  * `cc65`
* Clone the repository:
```
git clone <URL>
cd <repo name>
git submodule update --init
```

## Running

* To run all tests, type `make test` (or just `make`).
* To delete intermediate files (useful if something gets bugged), type `make clean`.
* To run only Verilog testbenches, type `make test-vl`.
* To run a particular testbench, type `make vl_test_<testname>`.
* To view the graph output from a given test, run `gtkwave waveforms/<testname>.fst`.

## Test system

The CPU designs in this repository are tested using a basic minimal system, with
a memory map as follows:
* ROM: 32 KB, address 0x8000 - 0xFFFF
* RAM: 16 KB, address 0x0000 - 0x3FFF
* Output port: 1 byte, address 0x4000
* Done port: 1 byte, address 0x4100

## Output verification

Assembly programs in `tests/assembly` are tested by comparing the output to a
256-byte hex file. The hex file may be either sourced from
`tests/assembly/<test>/verify.hex`, or generated by running the Python script
`tests/assembly/<test>/make_verify.py`.

Up to the first 256 bytes written to the output port will be compared against
the provided hex file when the simulation is terminated by writing any value to
the done port.

If the simulation doesn't terminate within 10^6 cycles, the test will fail with
a timeout (this takes about 1 minute with the in-order example CPU on my
laptop.) This value can be adjusted using the MAX_CYCLES parameter in
`rtl/system/toplevel.v`.